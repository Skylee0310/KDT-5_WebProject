# KDT-5_WebProject
경북대학교 KDT(Korea Digital Training) Web 프로젝트

## 영화 장르 및 평점 예측 모델

  
#### DATA
- TMDB
https://www.themoviedb.org/
  
#### 기능설계서

![image](https://github.com/KDT5-Web-3team/KDT-5_WebProject/assets/155441547/90cb4921-2d3e-44a6-b1e1-c0c7df7e25cf)









<details>
  <summary>
    박희진( 포스터로 장르 예측 모델 )
  </summary>
  
## (1) 데이터 생성 및 전처리

- tmdb 웹사이트에서 크롤링
    - 웹사이트가 동적 웹사이트여서 무한 스크롤 하면서 웹 크롤링 해야 했음. 끝 페이지에 도달했을 때, 계속 페이지가 닫겨서 결국 끝까지 스크롤하고 각 영화 정보 링크를 수집해서 파일 생성
    - movie_path.csv
- 포스터 이미지 링크, 제목, 장르, 러닝타임, 회원점수, 줄거리, 제작비,  수익, 감독 데이터 크롤링
    - 셀레늄 이용
    - try구문 이용하여 값이 없는 경우 None값이 입력되게 설정
    - 장르는 여러 개인 경우가 있어서 모든 장르 요소 크롤링 후 리스트 안에 담은 후 저장
    - 데이터프레임으로 저장 후 csv 파일로 변환
        - movie_data.csv
        - 약 10000개의 영화 데이터
- pd.read_csv로 movie_data.csv 불러오기
- 필요한 데이터는 포스터 이미지 링크와 장르기 때문에 포스터 이미지 링크와 장르가 None값인 행 삭제
- 데이터프레임에서 이미지 URL과 장르를 추출
    - 장르를 set안에 담아 장르 종류 확인
- *Animation > Horror > SF > Romance > Action > Comedy&Drama* 를 우선순위로 두고 여러 장르를 가진 영화를 하나의 장르로 함축
    - 포스터에서 특징이 강할 것 같은 장르 순으로 임의로 지정
- 포스터 URL과 장르 각 시리즈 concat을 통해 결합
- 유니크한 장르를 확인하고 각 라벨의 분포를 시각화

![스크린샷 2024-04-18 082820](https://github.com/KDT5-Web-3team/KDT-5_WebProject/assets/155441547/7423fdfd-117b-44e5-b84d-244ec48b8069)


- 다중 분류로 클래스를 나누니 각 클래스에 대한 데이터가 적음을 확인
    - 이미지 데이터 증강
        - 포스터 이미지의 분위기를 가장 해치지 않는 rotation 선택
        - 최대한 클래스별 비율을 맞춰가며 따로 데이터 증강
- 가장 많은 데이터를 가지는 Horror가 제일 적은 데이터를 가지는 SF에 비해 3배에 달하는 데이터를 보유
    - 데이터 불균형이 심함을 알 수  있음
    - 따라서 위의 우선 순위에서 Horror보다 SF를 우선으로 하고 새로 이미지 데이터 수집
- 데이터 증강 후 데이터 분포 확인

![스크린샷 2024-04-18 082749](https://github.com/KDT5-Web-3team/KDT-5_WebProject/assets/155441547/8ce1f7a0-6329-4d2d-8ef0-6501c86f0a21)


- 채널이 1인 흑백 포스터도 존재해서 이미지 URL 정도로 이미지를 열어 파일에 저장할 때 if문을 걸어 채널이 3인 경우에만 이미지와 라벨을 리스트안에 같이 저장
    - 폴더명은 라벨명, 폴더 내에는 이미지 데이터
    - 각 이미지 사이즈 ( 300, 450 )
- transforms을 통해 간단히 이미지 데이터 전처리
    - resize와 텐서화
    - resize((300, 300)) → resize((32, 32)) : 성능향상
        - 포스터 이미지를 세심하게 학습하기보다 전체적인 포스터 이미지의 분위기를 학습하게 했던 것이 성능향상의 요인으로 추청
- 이 후에 trianset과 valset을 만든 후 trainset 이미지의 RGB 채널의 평균과 표준편차를 구해 모든 데이터 셋 내의 이미지에 대해 정규화 진행
- 라벨 인코딩 적용

## (2) 데이터셋 준비

- 데이터셋 클래스 내에 텐서화 기능만 추가
- 라벨의 비율을 균형적으로 맞춰 학습시켜주기 위해 sklearn의 train_test_split 사용
    - stratify 매개변수를 이용하여 라벨 당 균형적으로 데이터가 데이터셋에 들어갈 수 있도록 함
    - 학습용 데이터와 검증용 데이터는 8 : 2로 분리

## (3) 데이터 로더 생성

- 클래스 별 비율을 계산하고 샘플러를 이용해 데이터 로더 구현
- 최종 모델의 배치 사이즈는 256으로 지정
    - 32, 64, 128, , 256, 512 시도

## (4) 여러 모델 클래스

- CNN()
    - 배치정규화 층
    - 가중치 초기화 층
    - 합성곱층 2층 + 풀링층 2층
    - 이미지 사이즈 : (300, 300)
- CNN32()
    - 이미지 사이즈 : (32, 32)
- DeepCNN32()
    - 더 깊은 학습신경망 구축
    - 합성곱층 4개 + 풀링층 3개
- CNN64()
    - 이미지 사이즈 : (64, 64)

## (5) 학습준비 - 학습함수, 평가함수

- 에포크는 100으로 지정
    - 학습 함수에 스케쥴러를 이용해 조기 종료 기능 구현
    - Valid Loss가 10번 이상 개선이 안되면 조기 종료
- 다중 분류 모델이기 때문에 CrossEntropyLoss 손실함수 이용
- 옵티마이저는 Adam 이용
    - 러닝메이트는 0.001로 지정

## (6) 최종 CNN 모델 평가

![스크린샷 2024-04-18 081851](https://github.com/KDT5-Web-3team/KDT-5_WebProject/assets/155441547/cccb51e2-faa1-4b0e-836a-94eb1a61ffd3)


- 처음에 정의했던 CNN 모델은 성능이 0.22로 매우 낮았음
    - 성능을 올리기 위해 다양한 방법을 시도
    - 성능을 올리기 위해 조절했던 요소
        - 배치사이즈 조정
        - 데이터 증강
            - 로테이션 이용
        - 균형적인 데이터 구축
            - 균형적이게 증강
            - trian_test_split 이용
            - 데이터 로더에서 샘플러 사용
        - 이미지 크기
            - (300, 300)
            - (32, 32)
            - (64 64)
            - (128, 128)
            - (256, 256)
        - 학습률
            - 0.001
            - 0.0001
        - 모델 복잡도
            - 합성곱층 추가
- 모델 정보
    - Batch size = 256
    - img size (32, 32)
    - lr = 0.001
    - CNN32() 모델 사용
    
    > Train Loss : 1.0291
    Train F1 Score : 0.57
    > 
    
    > Valid Loss : 1.1896
    Valid F1 Score : 0.51
    > 

> 성능 향상 : 0.22 → 0.51
> 

## (7) 예측

- 이미지를 받아서 저장한 후, 데이터 전처리할 때와 같이, 크기조정과 텐서화, RGB정규화 진행

## (8) 웹 구축

- cgi 사용
- model.css와 main.css를 공통적으로 적용
    - 모델 사용하는 html에 model.css, index.html에 mian.css 적용
- 한 웹페이지 안에 아이프레임을 생성하여 조원 버튼을 누를 때마다 조원 모델 페이지가 뜨게 설정
    - 각자 모델 페이지 안에서 예측 진행

## (9)  아쉬운 점

- 장르는 보통 국한되지 않음. 다중 레이블 분류 모델을 만들었다면 더욱 성능이 좋았을 것.

## (10) 피드백 : 모두에게

- 주제에 대한 타당성을 생각해라. 주제에 데이터가 적합한지 왜 주제를 그것으로 잡았는지 어떤 인사이트를 도출하기 위함인지에 대해 고민해봐라. 논문도 찾아보고 기술에 대한 고민도 해볼 것. 새로운 기술에 대해 지금 당장 이해가 되지 않아도 사용하면서 공부해라. 찾아보는 것도 능력이고, 새로운 기술을 이용하는 것도 능력, 새로운 기술을 빨리 익히는 것도 능력이다.
</details>
  
<details>
  <summary>
    김동현( 주제 )
  </summary>
  
</details>
  
<details>
  <summary>
    이화은( 영화 줄거리로 로맨스 영화 분류 )
  </summary>
<div markdown="1">
  
### 📝 주제 - 영화

  ![image](https://github.com/Skylee0310/KDT-5_WebProject/assets/155412049/9555f9d5-d9e4-4349-8c97-d64e278dfa3b)

| 📄 개인 주제 | 영화 줄거리로 로맨스 영화 분류 |
| --- | --- |
| 🙍🏻‍♂️ 팀원 | 김동현, 박희진, 양현우, 이화은 |
| 📊 PPT | https://buly.kr/DEX5Rlq |

✏ **개인** **주제 선정 배경**

- 줄거리를 통해서 장르를 예측할 수 있다면 영화 장르를 분류 후 라벨링 자동화 가능 有
- 또한 분류가 모호할 것으로 예상되는 스릴러, 호러, 미스터리 장르에 비해 비교적 확실히 분류가 될 것으로 예상되는 로맨스 장르와 그 외 장르를 분류해보기로 결정했다.

✏ **데이터**

- TMDB에 등록된 영화의 포스터, 제목, 줄거리, 감독 등 크롤링한 것을 사용.
- 영문 데이터

✏ **전처리**

- 결측값, 중복값 삭제
- 클래스 확인 ⇒ 불균형 데이터
- 텍스트 전처리 - spaCy 사용
  - spaCy :
      → 사이썬 기반으로 개발된 오픈 소스 라이브러리, 자연어 처리 기능 제공
      → NLTK와의 차이 : 빠른 속도와 정확도를 목표로 하는 머신러닝 기반 자연어 처리 라이브러리
  - 영어, 숫자 제외 삭제
  - 소문자 통일
  - 불용어 불포함, 공백 삭제
  - 2글자 이상일 경우 tokenList에 추가
- 어휘 사전 생성
- 인코딩
- 패딩
- 시각화
  ![image](https://github.com/Skylee0310/KDT-5_WebProject/assets/155412049/0b5e3e76-c23f-4c41-8245-59b2238da653)

✏ **모델 학습**
- LSTM 모델 사용
- epoch = 1000
- train loss : 0.27
- train accuracy : 0.93
- val loss : 0.26
- val accuracy : 0.93

✏ **예측**

- ⇒ 정확도는 높으나 심각한 데이터 불균형으로 인해 모든 영화가 ‘other(로맨스 외의 장르)’로 분류
<hr></hr>

✏ **WEB**
![image](https://github.com/Skylee0310/KDT-5_WebProject/assets/155412049/63a51942-29e9-49ee-a64a-aa633cc91569)

- 페이지
![image](https://github.com/Skylee0310/KDT-5_WebProject/assets/155412049/93751232-0f48-4dae-b04d-4a965aa4b5f0)


</div>
</details>


<details>
  <summary>
    양현우( 주제 )
  </summary>
</details>
